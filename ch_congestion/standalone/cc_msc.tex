% Created 2016-08-17 Wed 14:38
\documentclass[tikz]{standalone}

\input{../../templates/standalone_header}
\usepackage{ifthen}
\usetikzlibrary{decorations.pathreplacing,decorations.pathmorphing,calc}

\input{packet_drawing.latex}

\begin{document}

% \begin{tikzpicture}

%   \node [fill=hpiorange!10](a) {A};
%   \node [fill=hpiblue!10, right=3cm of a] (b) {B};

%   \draw (a) -- ++(0,-8); 
%   \draw (b) -- ++(0,-8);
  
%   \pplusa{0}{white}{0}{0}{1}{}
% \end{tikzpicture}


% \begin{tikzpicture}
%   \label{page:cc:one_cwnd_increase}
%   \node [fill=hpiorange!10](a) {A};
%   \node [fill=hpiblue!10, right=3cm of a] (b) {B};

%   \draw (a) -- ++(0,-18); 
%   \draw (b) -- ++(0,-18);
  
%   \pplusa{0}{white}{0}{0}{1}{}
%   % ----- 
%   \pplusa{4}{white}{0}{0}{2}{}
%   \pplusa{4.1}{white}{0}{0}{3}{}
%   % ----- 
%   \pplusa{8}{white}{0}{0}{4}{}
%   \pplusa{8.1}{white}{0}{0}{5}{}
%   \pplusa{8.2}{white}{0}{0}{6}{}
%   % ----- 
%   \pplusa{12}{white}{0}{0}{7}{}
%   \pplusa{12.1}{white}{0}{0}{8}{}
%   \pplusa{12.2}{white}{0}{0}{9}{}
%   \pplusa{12.3}{white}{0}{0}{10}{}

% \end{tikzpicture}



\begin{tikzpicture}
  \label{page:cc:one_cwnd_increase:exact:comments}
  \node [fill=hpiorange!10](a) {A};
  \node [fill=hpiblue!10, right=3cm of a] (b) {B};

  \node [left=of a] (inflight) {in flight}; 
  \node [left=of inflight] (cwnd) {CWND}; 
  \draw (a) -- ++(0,-11); 
  \draw (b) -- ++(0,-11);
  
  \pplusa{0}{hpiyellow!10}{0.3}{0}{1}{}
  \node at (cwnd |- pStartSend_1)  {1};
  \draw [dotted] (pEndSend_1) -- (inflight |- pEndSend_1) node  {1};
  
  % ----- after one RTT: 

  \node at (cwnd |- aEndReceive_1)  {1 + 1/1 = 2};
  \draw [dotted] (aEndReceive_1) -- (inflight |- aEndReceive_1) node  {0};
  
  \pplusa{2 + 0.3 + 0.05}{hpired!10}{0.3}{0}{2}{}
  
  \pplusa{2 + 2*0.3 + 2*0.05}{hpiblue!10}{0.3}{0}{3}{}
  \draw [dotted] (pEndSend_3) -- (inflight |- pEndSend_3) node  {2};


  
  % ----- after two RTTs: 
  \node at (cwnd |- aEndReceive_2)  {$2 + 1/2 = 2.5$};
  \draw [dotted] (aEndReceive_2) --  (inflight |- aEndReceive_2) node {1};


  
  \pplusa{2*2 + 2*0.3 + 1*0.05}{hpiorange!10}{0.3}{0}{4}{}

  \node at (cwnd |- aEndReceive_3)  {$2.5 + 1/2 = 3 $};
  \draw [dotted] (aEndReceive_3) --  (inflight |- aEndReceive_3) node {1};



  \pplusa{2*2 + 3*0.3 + 2*0.05}{hpiyellow!30}{0.3}{0}{5}{}
  \pplusa{2*2 + 4*0.3 + 3*0.05}{hpired!30}{0.3}{0}{6}{}

  \draw [dotted] (pEndSend_6) -- (inflight |- pEndSend_6) node  {3};
  
  % % ----- nach 3 RTTs
  \node at (cwnd |- aEndReceive_4)  {$3 + 1/3 = 3.33\dots  $};
  \draw [dotted] (aEndReceive_4) --  (inflight |- aEndReceive_4) node {2};
  
  
  \pplusa{3*2 + 3*0.3 + 2*0.05}{hpiblue!30}{0.3}{0}{7}{}

  \node at (cwnd |- aEndReceive_5)  {$3.33\dots  + 1/3 = 3.66\ldots $};
  \draw [dotted] (aEndReceive_5) --  (inflight |- aEndReceive_5) node {2};
  
  \pplusa{3*2 + 4*0.3 + 3*0.05}{hpiorange!30}{0.3}{0}{8}{}

  \node at (cwnd |- aEndReceive_6)  {$3.66\dots  + 1/3  = 4\ldots $};
  \draw [dotted] (aEndReceive_6) --  (inflight |- aEndReceive_6) node {2};

  \pplusa{3*2 + 5*0.3 + 4*0.05}{hpiyellow!60}{0.3}{0}{9}{}

  \pplusa{3*2 + 6*0.3 + 5*0.05}{hpired!60}{0.3}{0}{10}{}
  \draw [dotted] (pEndSend_10) -- (inflight |- pEndSend_10) node  {0};


\end{tikzpicture}


\begin{tikzpicture}
  \label{page:cc:one_cwnd_increase:exact:comments}
  \node [fill=hpiorange!10](a) {A};
  \node [fill=hpiblue!10, right=3cm of a] (b) {B};

  \node [left=of a] (inflight) {in flight}; 
  \node [left=of inflight] (cwnd) {CWND}; 
  \draw (a) -- ++(0,-11); 
  \draw (b) -- ++(0,-11);
  
  \pplusa{0}{hpiyellow!10}{0.3}{0}{1}{}
  \node at (cwnd |- pStartSend_1)  {1};
  \draw [dotted] (pEndSend_1) -- (inflight |- pEndSend_1) node  {1};
  
  % ----- after one RTT: 

  \node at (cwnd |- aEndReceive_1)  {2};
  \draw [dotted] (aEndReceive_1) -- (inflight |- aEndReceive_1) node  {0};
  
  \pplusa{2 + 0.3 + 0.05}{hpired!10}{0.3}{0}{2}{}
  
  \pplusa{2 + 2*0.3 + 2*0.05}{hpiblue!10}{0.3}{0}{3}{}
  \draw [dotted] (pEndSend_3) -- (inflight |- pEndSend_3) node  {2};


  
  % ----- after two RTTs: 
  \node at (cwnd |- aEndReceive_2)  {$2 + \frac{1}{2} = 2.5$};
  \draw [dotted] (aEndReceive_2) --  (inflight |- aEndReceive_2) node {1};


  
  \pplusa{2*2 + 2*0.3 + 1*0.05}{hpiorange!10}{0.3}{0}{4}{}

  \node at (cwnd |- aEndReceive_3)  {$2.5 + \frac{1}{2.5} = 2.9 $};
  \draw [dotted] (aEndReceive_3) --  (inflight |- aEndReceive_3) node {1};



  \pplusa{2*2 + 3*0.3 + 2*0.05}{hpiyellow!30}{0.3}{0}{5}{}
  % \pplusa{2*2 + 4*0.3 + 3*0.05}{hpired!30}{0.3}{0}{6}{}

  \draw [dotted] (pEndSend_5) -- (inflight |- pEndSend_5) node  {2};
  
  % % ----- nach 3 RTTs
  \node at (cwnd |- aEndReceive_4)  {$2.9 + \frac{1}{2.9} \approx 3.2 $};
  \draw [dotted] (aEndReceive_4) --  (inflight |- aEndReceive_4) node {1};
  
  
  \pplusa{3*2 + 3*0.3 + 2*0.05}{hpiblue!30}{0.3}{0}{6}{}

  \node at (cwnd |- aEndReceive_5)  {$3.2 + \frac{1}{3.2} \approx 3.5 $};
  \draw [dotted] (aEndReceive_5) --  (inflight |- aEndReceive_5) node {1};
  
  \pplusa{3*2 + 4*0.3 + 3*0.05}{hpiorange!30}{0.3}{0}{7}{}
  \pplusa{3*2 + 5*0.3 + 4*0.05}{hpiyellow!60}{0.3}{0}{8}{}

  \draw [dotted] (pEndSend_8) -- (inflight |- pEndSend_8) node  {3};

  % \pplusa{3*2 + 6*0.3 + 5*0.05}{hpired!60}{0.3}{0}{10}{}

\end{tikzpicture}


\begin{tikzpicture}
  \label{page:cc:slowstart:comments}
  \node [fill=hpiorange!10](a) {A};
  \node [fill=hpiblue!10, right=3cm of a] (b) {B};

  \node [left=of a] (inflight) {in flight}; 
  \node [left=of inflight] (cwnd) {CWND}; 
  \draw (a) -- ++(0,-18); 
  \draw (b) -- ++(0,-18);
  
  \pplusa{0}{hpiyellow!10}{0.3}{0}{1}{}
  \node at (cwnd |- pStartSend_1)  {1};
  \draw [dotted] (pEndSend_1) -- (inflight |- pEndSend_1) node  {1};
  
  % ----- after one RTT: 

  \node at (cwnd |- aEndReceive_1)  {1 + 1 = 2};
  \draw [dotted] (aEndReceive_1) -- (inflight |- aEndReceive_1) node  {0};
  
  \pplusa{2 + 0.3 + 0.05}{hpired!10}{0.3}{0}{2}{}
  
  \pplusa{2 + 2*0.3 + 2*0.05}{hpiblue!10}{0.3}{0}{3}{}
  \draw [dotted] (pEndSend_3) -- (inflight |- pEndSend_3) node  {2};


  
  % ----- after two RTTs: 
  \node at (cwnd |- aEndReceive_2)  {2 + 1 = 3};
  \draw [dotted] (aEndReceive_2) --  (inflight |- aEndReceive_2) node {1};


  
  \pplusa{2*2 + 2*0.3 + 1*0.05}{hpiorange!10}{0.3}{0}{4}{}

  \node at (cwnd |- aEndReceive_3)  {3 + 1 =  4};
  \draw [dotted] (aEndReceive_3) --  (inflight |- aEndReceive_3) node {1};



  \pplusa{2*2 + 3*0.3 + 2*0.05}{hpiyellow!30}{0.3}{0}{5}{}
  \pplusa{2*2 + 4*0.3 + 3*0.05}{hpired!30}{0.3}{0}{6}{}
  \pplusa{2*2 + 5*0.3 + 4*0.05}{hpiblue!30}{0.3}{0}{7}{}
  

  \draw [dotted] (pEndSend_7) -- (inflight |- pEndSend_7) node  {4};
  
  % % ----- nach 3 RTTs
  \node at (cwnd |- aEndReceive_4)  {4 + 1 = 5};
  \draw [dotted] (aEndReceive_4) --  (inflight |- aEndReceive_4) node {3};
  
  

  \node at (cwnd |- aEndReceive_5)  {5 + 1 = 6};
  \draw [dotted] (aEndReceive_5) --  (inflight |- aEndReceive_5) node {3};
  
  \pplusa{3*2 + 3*0.3 + 1*0.05}{hpiorange!30}{0.3}{0}{8}{}

  \node at (cwnd |- aEndReceive_6)  {6 + 1 = 7};
  \draw [dotted] (aEndReceive_6) --  (inflight |- aEndReceive_6) node {3};

  \pplusa{3*2 + 4*0.3 + 2*0.05}{hpiyellow!60}{0.3}{0}{9}{}

  \node at (cwnd |- aEndReceive_7)  {7 + 1 = 8};
  \draw [dotted] (aEndReceive_7) --  (inflight |- aEndReceive_7) node {3};

  
  \pplusa{3*2 + 5*0.3 + 3*0.05}{hpired!60}{0.3}{0}{10}{}
  \pplusa{3*2 + 6*0.3 + 4*0.05}{hpiblue!60}{0.3}{0}{11}{}
  \draw [dotted] (pEndSend_11) -- (inflight |- pEndSend_11) node  {4};

  % and second half of the 8 CWND
  \pplusa{3*2 + 7*0.3 + 5*0.05}{hpiorange!60}{0.3}{0}{12}{}
  \pplusa{3*2 + 8*0.3 + 6*0.05}{hpiyellow!90}{0.3}{0}{13}{}
  \pplusa{3*2 + 9*0.3 + 7*0.05}{hpired!90}{0.3}{0}{14}{}

  \node at (cwnd |- aEndReceive_8)  {8 + 1 = 9};
  \draw [dotted] (pEndSend_14) -- (inflight |- pEndSend_14) node  {7};
  
  \node at (cwnd |- aEndReceive_9)  {9 + 1 = 10};
  \pplusa{3*2 + 10*0.3 + 8*0.05}{hpiblue!90}{0.3}{0}{15}{}
  \draw [dotted] (pEndSend_15) -- (inflight |- pEndSend_15) node  {8};


  \node [below left=of pEndSend_15, align=right] (label) {Continuous sending possible!};
  \draw [dotted, ->] (label) -- (pEndSend_15); 

  
  

\end{tikzpicture}



% \begin{tikzpicture}
%   \label{page:cc:slowstart}
%   \node [fill=hpiorange!10](a) {A};
%   \node [fill=hpiblue!10, right=3cm of a] (b) {B};

%   \draw (a) -- ++(0,-18); 
%   \draw (b) -- ++(0,-18);
  
%   \pplusa{0}{white}{0.3}{0}{1}{}
%   % ----- 
%   \pplusa{4}{white}{0.3}{0}{2}{}
%   \pplusa{4.1}{white}{0.3}{0}{3}{}
%   % ----- 
%   \pplusa{8}{white}{0.3}{0}{4}{}
%   \pplusa{8.1}{white}{0.3}{0}{5}{}
%   \pplusa{8.2}{white}{0.3}{0}{6}{}
%   \pplusa{8.3}{white}{0.3}{0}{7}{}
%   % ----- 
%   \pplusa{12}{white}{0.3}{0}{8}{}
%   \pplusa{12.1}{white}{0.3}{0}{9}{}
%   \pplusa{12.2}{white}{0.3}{0}{10}{}
%   \pplusa{12.3}{white}{0.3}{0}{11}{}
%   \pplusa{12.4}{white}{0.3}{0}{12}{}
%   \pplusa{12.5}{white}{0.3}{0}{13}{}
%   \pplusa{12.6}{white}{0.3}{0}{14}{}
%   \pplusa{12.7}{white}{0.3}{0}{15}{}

% \end{tikzpicture}


\end{document}